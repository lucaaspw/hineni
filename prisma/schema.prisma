// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Music {
  id           String   @id @default(cuid())
  title        String
  artist       String?
  lyrics       String
  chords       String?
  externalLink String?  // Link do YouTube ou Spotify
  isNewOfWeek  Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relacionamento com o repertório semanal
  weeklyRepertoire WeeklyRepertoire[]

  @@index([title, artist]) // Índice para busca por título e artista
  @@index([isNewOfWeek]) // Índice para música nova da semana
  @@index([createdAt]) // Índice para ordenação por data de criação
  @@map("musics")
}

model WeeklyRepertoire {
  id        String   @id @default(cuid())
  musicId   String
  position  Int      // Posição no repertório (1-6)
  isManual  Boolean  @default(false) // Se foi adicionada manualmente
  weekStart DateTime // Data de início da semana
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento com a música
  music Music @relation(fields: [musicId], references: [id], onDelete: Cascade)

  @@unique([position, weekStart]) // Garante que cada posição seja única por semana
  @@index([position]) // Índice para ordenação por posição
  @@index([weekStart]) // Índice para filtros por semana
  @@index([musicId]) // Índice para relacionamento com música
  @@map("weekly_repertoire")
}

model Admin {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // Hash da senha
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model Scale {
  id        String   @id @default(cuid())
  date      DateTime // Data do domingo
  year      Int      // Ano da escala
  members   String[] // Array de nomes dos membros (incluindo Lucas sempre)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([date]) // Garante que cada domingo tenha apenas uma escala
  @@index([year]) // Índice para filtros por ano
  @@index([date]) // Índice para ordenação por data
  @@map("scales")
}